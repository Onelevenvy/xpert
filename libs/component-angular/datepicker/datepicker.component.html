<label class="p-1 text-sm text-ellipsis whitespace-nowrap overflow-hidden disabled:opacity-50">
  {{ 'COMPONENTS.DATE_PICKER.Date' | translate: {Default: 'Date'} }}
</label>

<ng-container [ngSwitch]="selectionType">
  <ng-container *ngSwitchCase="FilterType.SingleRange">
    <ng-container [ngSwitch]="granularity">
      <ng-container *ngSwitchCase="TimeGranularity.Year">
        <ngm-year-filter class="flex flex-1 mr-2" [formControl]="fromDateControl" [appearance]="appearance" [label]="'COMPONENTS.DATE_PICKER.From' | translate: {Default: 'From'}">
        </ngm-year-filter>

        <ngm-year-filter class="flex flex-1" [formControl]="dateControl" [appearance]="appearance" [label]="'COMPONENTS.DATE_PICKER.To' | translate: {Default: 'To'}">
          <button mat-icon-button [matMenuTriggerFor]="granularityMenu"
            (click)="$event.stopPropagation();$event.preventDefault();">
              <mat-icon>more_vert</mat-icon>
          </button>
        </ngm-year-filter>
      </ng-container>
      <ng-container *ngSwitchCase="TimeGranularity.Quarter">
        <ngm-quarter-filter class="flex flex-1 mr-2" [formControl]="fromDateControl" [appearance]="appearance" [label]="'COMPONENTS.DATE_PICKER.From' | translate: {Default: 'From'}">
        </ngm-quarter-filter>

        <ngm-quarter-filter class="flex flex-1" [formControl]="dateControl" [appearance]="appearance" [label]="'COMPONENTS.DATE_PICKER.To' | translate: {Default: 'To'}">
          <button mat-icon-button [matMenuTriggerFor]="granularityMenu"
            (click)="$event.stopPropagation();$event.preventDefault();">
              <mat-icon>more_vert</mat-icon>
          </button>
        </ngm-quarter-filter>
      </ng-container>
      <ng-container *ngSwitchCase="TimeGranularity.Month">
        <ngm-month-filter class="flex flex-1 mr-2" [formControl]="fromDateControl" [appearance]="appearance" [label]="'COMPONENTS.DATE_PICKER.From' | translate: {Default: 'From'}">
        </ngm-month-filter>

        <ngm-month-filter class="flex flex-1" [formControl]="dateControl" [appearance]="appearance" [label]="'COMPONENTS.DATE_PICKER.To' | translate: {Default: 'To'}">
          <button mat-icon-button [matMenuTriggerFor]="granularityMenu"
            (click)="$event.stopPropagation();$event.preventDefault();">
              <mat-icon>more_vert</mat-icon>
          </button>
        </ngm-month-filter>
      </ng-container>
    
      <ng-container *ngSwitchDefault>
        <mat-form-field class="flex flex-1 mr-2" [appearance]="appearance">
          <mat-label>{{ 'COMPONENTS.DATE_PICKER.From' | translate: {Default: 'From'} }}</mat-label>
          <input matInput [matDatepicker]="picker" [formControl]="fromDateControl">
          <mat-datepicker #picker></mat-datepicker>
          <div matSuffix class="flex items-center">
            <mat-datepicker-toggle [for]="picker"></mat-datepicker-toggle>
            <button mat-icon-button [matMenuTriggerFor]="granularityMenu"
              (click)="$event.stopPropagation();$event.preventDefault();">
                <mat-icon>more_vert</mat-icon>
            </button>
          </div>
        </mat-form-field>

        <mat-form-field class="flex flex-1" [appearance]="appearance">
            <mat-label>{{ 'COMPONENTS.DATE_PICKER.To' | translate: {Default: 'To'} }}</mat-label>
            <input matInput [matDatepicker]="picker2" [formControl]="dateControl">
            <mat-datepicker #picker2></mat-datepicker>
            <div matSuffix class="flex items-center">
              <mat-datepicker-toggle [for]="picker2"></mat-datepicker-toggle>
              <button mat-icon-button [matMenuTriggerFor]="granularityMenu"
                (click)="$event.stopPropagation();$event.preventDefault();">
                  <mat-icon>more_vert</mat-icon>
              </button>
            </div>
        </mat-form-field>
      </ng-container>
    </ng-container>
  </ng-container>

  <ng-container *ngSwitchDefault>
    <ng-container [ngSwitch]="granularity">
      <ng-container *ngSwitchCase="TimeGranularity.Year">
        <ngm-yearpicker [formControl]="dateControl">
          <button ngmSuffix mat-icon-button displayDensity="compact" [matMenuTriggerFor]="granularityMenu"
            (click)="$event.stopPropagation();$event.preventDefault();">
              <mat-icon>more_vert</mat-icon>
          </button>
        </ngm-yearpicker>
      </ng-container>
      <ng-container *ngSwitchCase="TimeGranularity.Quarter">
        <ngm-quarterpicker [formControl]="dateControl">
          <button ngmSuffix mat-icon-button displayDensity="compact" [matMenuTriggerFor]="granularityMenu"
            (click)="$event.stopPropagation();$event.preventDefault();">
              <mat-icon>more_vert</mat-icon>
          </button>
        </ngm-quarterpicker>
      </ng-container>
      <ng-container *ngSwitchCase="TimeGranularity.Month">
        <ngm-monthpicker [formControl]="dateControl">
          <button ngmSuffix mat-icon-button displayDensity="compact" [matMenuTriggerFor]="granularityMenu"
            (click)="$event.stopPropagation();$event.preventDefault();">
              <mat-icon>more_vert</mat-icon>
          </button>
        </ngm-monthpicker>
      </ng-container>
    
      <ng-container *ngSwitchDefault>
        <ngm-datepicker [formControl]="dateControl">
          <button ngmSuffix mat-icon-button displayDensity="compact" [matMenuTriggerFor]="granularityMenu"
            (click)="$event.stopPropagation();$event.preventDefault();">
              <mat-icon>more_vert</mat-icon>
          </button>
        </ngm-datepicker>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>


<mat-radio-group [(ngModel)]="granularity">
  <mat-menu #granularityMenu="matMenu" class="ngm-formly ngm-density__compact">
    <button mat-menu-item disableRipple *ngFor="let value of TIME_GRANULARITY_SEQUENCES[granularitySequence]"
      (click)="$event.stopPropagation();">
      <mat-radio-button [value]="value">
        {{ 'COMPONENTS.DATE_PICKER.' + value | translate: {Default: value} }}
      </mat-radio-button>
    </button>
  </mat-menu>
</mat-radio-group>
