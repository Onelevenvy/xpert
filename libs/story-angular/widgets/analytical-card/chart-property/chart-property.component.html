<ngm-property-select class="max-w-full"
  [formControl]="formControl"
  [editable]="true"
  [showAttributes]="true"
  [dataSettings]="dataSettings"
  [entityType]="entityType"
  [restrictedDimensions]="restrictedDimensions$ | async"
  [coreService]="coreService"
  [dsCoreService]="dsCoreService"
  [capacities]="capacities"
  [syntax]="syntax()"
  displayDensity="compact"
  (calculationChange)="onCalculationChange($event)"
>
  <div ngmSuffix>
    <ng-content select="[ngmSuffix]"></ng-content>
  </div>

  <div class="w-full flex flex-col items-stretch gap-1">
    <ng-container *ngIf="showChartAttributes && isDimension()">
      <div class="ngm-chart-property__card">
        <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
          <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">category</mat-icon>
          <span>{{ 'FORMLY.PROPERTY_SELECT.Role' | translate: {Default: 'Role'} }}</span>
        </label>
        <mat-radio-group [(ngModel)]="role">
          <mat-radio-button *ngFor="let role of DIMENSION_ROLES" [value]="role.value">
            {{ 'FORMLY.PROPERTY_SELECT.' + role.label | translate: {Default: role.label} }}
          </mat-radio-button>
        </mat-radio-group>
      </div>

      <div class="ngm-chart-property__card">
        <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
          <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">analytics</mat-icon>
          <span>{{ 'FORMLY.PROPERTY_SELECT.ChartOptions' | translate: {Default: 'Chart Options'} }}</span>
        </label>
        <ngm-designer-form class="w-full text-sm" [(ngModel)]="chartOptions"></ngm-designer-form>
      </div>
    </ng-container>

    <div *ngIf="showMeasureRole" class="ngm-chart-property__card">
      <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
        <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">category</mat-icon>
        <span>{{ 'FORMLY.PROPERTY_SELECT.Role' | translate: {Default: 'Role'} }}</span>
      </label>
      <mat-radio-group [(ngModel)]="role">
        <mat-radio-button *ngFor="let role of MEASURE_ROLES" [value]="role.value">
          {{ 'FORMLY.PROPERTY_SELECT.' + role.label | translate: {Default: role.label} }}
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div *ngIf="showMeasureShape" class="ngm-chart-property__card">
      <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
        <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">interests</mat-icon>
        <span>{{ 'FORMLY.PROPERTY_SELECT.Shape' | translate: {Default: 'Shape'} }}...</span>
      </label>
      <mat-radio-group [(ngModel)]="shapeType">
        <mat-radio-button [value]="null">
          {{ 'FORMLY.PROPERTY_SELECT.None' | translate: {Default: 'None'} }}
        </mat-radio-button>
        <mat-radio-button *ngFor="let shape of SHAPE_TYPES" [value]="shape.value">
          {{ 'FORMLY.PROPERTY_SELECT.' + shape.label | translate: {Default: shape.label} }}
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div *ngIf="showColorPalette" class="ngm-chart-property__card">
      <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
        <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">texture</mat-icon>
        <span>{{ 'FORMLY.PROPERTY_SELECT.Pattern' | translate: {Default: 'Pattern'} }}</span>
      </label>
      <mat-radio-group [(ngModel)]="pattern">
        <mat-radio-button [value]="null">
          {{ 'FORMLY.PROPERTY_SELECT.None' | translate: {Default: 'None'} }}
        </mat-radio-button>
        <mat-radio-button *ngFor="let item of PATTERNS" [value]="item.value">
          {{item.label}}
        </mat-radio-button>
      </mat-radio-group>
    
      <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
        <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">style</mat-icon>
        <span>{{ 'FORMLY.PROPERTY_SELECT.Style' | translate: {Default: 'Style'} }}</span>
      </label>

      <button mat-flat-button displayDensity="comfortable" class="ngm-chart-property__palette-trigger w-full" [matMenuTriggerFor]="paletteMenu">
        <div class="w-full flex items-center">
          <mat-icon fontSet="material-icons-outlined">palette</mat-icon>
          <span>{{ 'FORMLY.PROPERTY_SELECT.Palette' | translate: {Default: 'Palette'} }}</span>
          <span class="flex-1"></span>
          
          <mat-icon fontSet="material-icons-outlined">arrow_right</mat-icon>
        </div>
      </button>

      <div class="flex justify-start items-center">
        <ngm-colors class="flex-1" [label]=" 'FORMLY.PROPERTY_SELECT.Colors' | translate: {Default: 'Colors'} "
          [options]="colorPalettes"
          [(ngModel)]="colors"
          (ngModelChange)="onColorsChange($event)"
          (click)="$event.stopPropagation()">
        </ngm-colors>
      </div>
    </div>

    <!-- For analytical grid @todo move to analytical grid module -->
    <div *ngIf="showMeasureGridBar" class="ngm-chart-property__card">
      <mat-checkbox [(ngModel)]="bar">
        <div class="flex-1 flex items-center">
          <mat-icon class="shrink-0" fontSet="material-icons-outlined">sort</mat-icon>
          <span>{{ 'FORMLY.PROPERTY_SELECT.BarChart' | translate: {Default: 'Bar Chart'} }}</span>
        </div>
      </mat-checkbox>
    </div>
    <!-- End -->

    <div *ngIf="showMeasureReferenceLine" class="ngm-chart-property__card">
      <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
        <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">trending_flat</mat-icon>
        <span>{{ 'FORMLY.PROPERTY_SELECT.REFERENCE_LINE' | translate: {Default: 'Reference Line'} }}</span>
      </label>

      <ngm-reference-line class="w-full text-sm" [(ngModel)]="referenceLines"></ngm-reference-line>
    </div>

    <div *ngIf="showMeasureChartOptions" class="ngm-chart-property__card">
      <label class="ngm-chart-property__card-title flex justify-start items-center px-2 py-1">
        <mat-icon class="shrink-0" fontSet="material-icons-outlined" displayDensity="compact">analytics</mat-icon>
        <span>{{ 'FORMLY.PROPERTY_SELECT.ChartOptions' | translate: {Default: 'Chart Options'} }}</span>
      </label>

      <ngm-chart-measure-form class="w-full text-sm" [(ngModel)]="chartOptions"
        [chartType]="chartType"
      ></ngm-chart-measure-form>
    </div>
  </div>
</ngm-property-select>


<mat-radio-group [(ngModel)]="palette" displayDensity="cosy">
  <mat-menu #paletteMenu="matMenu" class="ngm-formly ngm-density__compact">

    <ng-template matMenuContent>
      <button mat-menu-item disableRipple (click)="$event.stopPropagation();">
        <mat-radio-button class="ngm-radio-button__property" [value]="null">
          {{ 'FORMLY.PROPERTY_SELECT.None' | translate: {Default: 'None'} }}
        </mat-radio-button>
      </button>
  
      <ng-container *ngFor="let group of interpolateGroups">
        <button mat-menu-item disableRipple disabled>
          {{group.groupName}}
        </button>
  
        <button mat-menu-item disableRipple *ngFor="let interpolate of group.values"
          (click)="$event.stopPropagation();">
          <mat-radio-button [value]="interpolate.name" class="ngm-radio-button__property flex-1 w-full">
            <ngm-chromatic-preview class="flex-1 w-full" [interpolate]="interpolate"></ngm-chromatic-preview>
          </mat-radio-button>
        </button>
      </ng-container>
    </ng-template>
  </mat-menu>
</mat-radio-group>
