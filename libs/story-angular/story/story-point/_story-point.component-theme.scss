@use '@angular/material' as mat;

@mixin ngm-story-point($config-or-theme) {
  $config: mat.get-color-config($config-or-theme);
  $foreground: map-get($config, foreground);
  $background: map-get($config, background);
  $primary: map-get($config, primary);
  $accent: map-get($config, accent);

  $grid-divider: 1px dashed map-get($foreground, divider);

  %widget-editable {
    border-color: map-get($accent, 500);
    .ngm-drag-handler {
      background-color: mat.get-color-from-palette($foreground, divider);
    }
  }

  .ngm-story-point {
    transition: all 500ms cubic-bezier(0.35, 0, 0.25, 1);

    &:not(.ngm-story-point__multi-layer) {
      .ngm-story__widget.active {
        // 之前注释掉是因为影响到了多层部件下的上下关系???
        z-index: 2 !important;
      }
    }

    .ngm-story-point__page {
      
      /* page size styling */
      &.ngm-story-point__size-a4 {
        @include mat.elevation(8);
        margin: auto;
        padding: 1rem;
        width: 1240px;
        height: 1754px;
  
        &.ngm-story-point__size-continuous-height {
          height: auto;
        }
      }
    }

    .ngm-story__widget {
      &.active {
        .ngm-story-widget__fab-menu {
          visibility: visible;
        }
      }

      &.ngm-fullscreen {
        width: 100% !important;
        height: 100% !important;
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        transform: none !important;
        z-index: 1000 !important;
        
        .ngm-story-widget__fab-menu {
          right: 0;
          opacity: .2;
          &:hover {
            opacity: 1;
          }
        }
      }

      &:not(.ngm-fullscreen) {
        border: 1px dashed transparent;
        &.active.editable {
          @extend %widget-editable;
        }
        &:hover.editable {
          @extend %widget-editable;
        }
      }
      
    }
    
    /* focusing */
    &.ngm-story__focus {
      background-color: rgb(204, 204, 204);

      .ngm-story__widget:not(.ngm-story__focus) {
        opacity: 0.35;
      }
      .ngm-story__widget.ngm-story__focus {
        .ngm-story-widget__content {
          @include mat.elevation(8);
          background-color: mat.get-color-from-palette($background, card);
        }
      }
    }

    .ngm-story-point__quick-start {
      .ngm-story-point__quick-start-widget:hover {
        color: mat.get-color-from-palette($foreground, text);
        background-color: mat.get-color-from-palette($primary);
        font-weight: 600;
      }
    }
  }

  /* 移动端页面 */
  .ngm-story__layout.mobile {
    .ngm-story-widget {
      width: 100%;
      max-width: 100%;
      margin-bottom: 1rem;

      .ngm-story-widget__content.ngm-story-widget__card {
        min-height: 300px;
      }
      &.ngm-fullscreen {
        width: 100% !important;
        height: 100% !important;
        position: absolute !important;
      }
      .ngm-story-widget__content {
        overflow: visible;
      }

      .ngm-story-widget__fab-menu {
        top: -40px;
        right: 0;
      }
    }
  }

  /* gridster 网格样式 */
  gridster.ngm-story__layout {
    overflow: visible;

    &.gridSize:not(.fit) {
      margin: auto;
    }
    &.scrollVertical {
      // position: initial;
      // height: initial;
    }
    &.display-grid {
      .ngm-story__widget {
        border-color: map-get($foreground, divider);
      }
    }
    
    .gridster-column {
      border-left: $grid-divider;
      border-right: $grid-divider;
    }

    .gridster-row {
      border-top: $grid-divider;
      border-bottom: $grid-divider;
    }

    .gridster-item-resizable-handler:hover {
      background-color: map-get($foreground, divider);
    }

    .gridster-preview {
      background-color: map-get($foreground, divider);
    }
  }

  gridster-item.ngm-story__widget {
    background: unset;
  }

  @media print {
    header, footer, aside, form {
      display: none;
    }
  }

  .ngm-story-point__responsive {
    min-height: 100%;
  }
  
}
