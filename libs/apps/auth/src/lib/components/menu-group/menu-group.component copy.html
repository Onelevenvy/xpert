<ul class="flex flex-col gap-1">
  @for (item of menu; track $index) {
    <li>
      @if (isCollapsed) {
        <button mat-icon-button class="opacity-80 hover:opacity-100 hover:scale-110 transition-transform duration-200"
          [matTooltip]="item.title"
          matTooltipPosition="right"
          [matMenuTriggerFor]="item.children ? subMenus : null"
          [routerLink]="item.link"
          routerLinkActive
          #rla="routerLinkActive"
          [class.active]="rla.isActive">
          <mat-icon fontSet="material-icons-round">{{ item.matIcon }}</mat-icon>
        </button>

        <mat-menu #subMenus="matMenu" xPosition="before">
          @for (child of item.children; track $index) {
            <button mat-menu-item
              [routerLink]="child.link"
              routerLinkActive [routerLinkActiveOptions]="{ exact: true }"
              #rla="routerLinkActive"
              (isActiveChange)="child.isActive = $event"
              [class.active]="rla.isActive"
              (click)="clicked.emit()"
            >
              @if (child.matIcon) {
                <mat-icon fontSet="material-icons-round">{{ child.matIcon }}</mat-icon>
              }

              <span>{{ child.title }}</span>
            </button>
          }
        </mat-menu>
      } @else {
        <div class="pac-router-link flex items-center py-3 px-4 rounded-lg cursor-pointer hover:bg-white/10 transition-colors"
          [class.has-submenu]="item.children"
          [routerLink]="item.children ? null : item.link"
          routerLinkActive
          #rla="routerLinkActive"
          [class.active]="rla.isActive"
          (click)="item.expanded=!isActive(item)"
        >
          @if (item.matIcon) {
            <mat-icon displayDensity="cosy" fontSet="material-icons-round">{{ item.matIcon }}</mat-icon>
          }

          <span class="flex-1 ml-3">{{ item.title }}</span>

          @if (item.children) {
            <svg class="ml-auto w-3 h-3" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path [attr.d]="item.expanded ? 'M2 11L8.16086 5.31305C8.35239 5.13625 8.64761 5.13625 8.83914 5.31305L15 11' : 'M2 5L8.16086 10.6869C8.35239 10.8637 8.64761 10.8637 8.83914 10.6869L15 5'" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                style="transition: all 200ms ease-in-out 0s">
              </path>
            </svg>
          }
        </div>

        @if (item.children) {
          <ul class="pac-sub-menu flex flex-col ml-3 mt-1" [class.expanded]="isActive(item)"
            [class.gap-1]="isActive(item)"
          >
            @for (child of item.children; track $index) {
              @if (!child.hidden) {
                <li class="pac-router-link flex items-center py-2 px-4 rounded-lg cursor-pointer hover:bg-white/10 transition-colors"
                  [routerLink]="child.link"
                  routerLinkActive [routerLinkActiveOptions]="{ exact: true }"
                  #rla="routerLinkActive"
                  (isActiveChange)="child.isActive = $event"
                  [class.active]="rla.isActive"
                  (click)="clicked.emit()">
                  @if (child.matIcon) {
                    <mat-icon displayDensity="compact" fontSet="material-icons-round">{{ child.matIcon }}</mat-icon>
                  }
                  <span class="ml-3">{{ child.title }}</span>
                </li>
              }
            }
          </ul>
        }
      }
    </li>
  }
</ul>
