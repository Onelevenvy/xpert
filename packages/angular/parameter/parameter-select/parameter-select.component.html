<ngm-input searchable [label]="label" [placeholder]="placeholder"
  [options]="parameters$ | async"
  valueKey="key"
  [(ngModel)]="model"
>
  <div ngmSuffix class="ngm-input__suffix flex items-center">
    <button mat-icon-button displayDensity="compact" [cdkMenuTriggerFor]="paramMenu"
      (click)="$event.stopPropagation(); $event.preventDefault()">
      <mat-icon>alternate_email</mat-icon>
    </button>

    <ng-content select="[ngmSuffix]"></ng-content>
  </div>

  <ng-template ngmOptionContent let-option>
    <button mat-icon-button displayDensity="cosy" (click)="openEditParameter(option.name)">
      <mat-icon fontSet="material-icons-outlined">edit</mat-icon>
    </button>
  </ng-template>
</ngm-input>

<ng-template #paramMenu>
  <div cdkMenu class="cdk-menu__large">
    @for (parameter of parameters$ | async; track parameter.key) {
      <div cdkMenuItemRadio 
        [cdkMenuItemChecked]="model() === parameter.key"
        (cdkMenuItemTriggered)="model.set(parameter.key)"
      >
        <ngm-display-behaviour class="grow" [option]="parameter" />
        <button type="button" class="shrink-0 w-7 h-7 flex justify-center items-center rounded-full text-text-secondary hover:text-text-primary hover:bg-hover-bg"
          (click)="$event.stopPropagation(); openEditParameter(parameter.value.name)">
          <i class="ri-edit-line"></i>
        </button>
      </div>
    }

    <div class="w-full border-t border-solid border-divider-deep my-1"></div>

    <button cdkMenuItem class="!border border-dashed border-divider-regular"
      (click)="$event.stopPropagation();openCreate()">
      {{ 'Ngm.Property.CreateParameter' | translate: {Default: "Create Parameter"} }}
    </button>
  </div>
</ng-template>
