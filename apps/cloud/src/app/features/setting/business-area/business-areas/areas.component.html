<div class="w-80 h-full flex flex-col pb-4 self-stretch relative">
    <div class="flex justify-start px-2 pb-4">
        <div ngmButtonGroup >
            <button mat-raised-button color="primary" (click)="addGroup(null)">
                <div class="flex items-center">
                    <mat-icon>add</mat-icon>
                    {{ 'PAC.ACTIONS.NEW' | translate: {Default: "New"} }} {{ 'PAC.KEY_WORDS.BUSINESS_AREA' | translate: {Default: "Business Area"} }}
                </div>
            </button>
        </div>
    </div>

    <ngm-tree-table class="w-80 h-full overflow-auto rounded-xl border border-gray-200"
        [data]="groupTree$ | async"
        [columns]="[
            {
                name: 'action',
                caption: 'PAC.KEY_WORDS.ACTION' | translate: {Default: 'Action'},
                cellTemplate: actionTempl
            }
        ]"
        [nameLabel]=" 'PAC.MODEL.Name' | translate: {Default: 'Name'} "
        [displayDensity]="DisplayDensity.compact"
        [nameCellTemplate]="nameTempl"
        [initialLevel]="1000"
        [stickyHeaders]="true"
        >
    </ngm-tree-table>

    <div *ngIf="loading" class="emoji-loader h-full w-full"></div>
</div>

<router-outlet #o="outlet"></router-outlet>


<ng-template #nameTempl let-key="key" let-name="name" let-item="raw">
    <div class="inline-flex items-center whitespace-nowrap">
        <a [routerLink]="['./', key]" ><span>{{name}}</span></a>
    </div>
</ng-template>

<ng-template #actionTempl let-item="raw">
    <div class="flex justify-start items-center gap-4">
        <button mat-icon-button displayDensity="cosy" class="text-slate-500"
            (click)="addGroup(item)">
            <mat-icon fontSet="material-icons-outlined">add</mat-icon>
        </button>
        
        <button mat-icon-button ngmAppearance="danger" displayDensity="cosy" class="text-slate-500"
            (click)="deleteBusinessArea(item)">
            <mat-icon fontSet="material-icons-outlined">remove</mat-icon>
        </button>
    </div>
</ng-template>

<ng-template #createTempl cdkTrapFocus>
    <header mat-dialog-title cdkDrag cdkDragRootElement=".cdk-overlay-pane" cdkDragHandle>
        <h4 style="pointer-events: none;">
            {{ 'PAC.ACTIONS.CREATE' | translate: {Default: "Create"} }} {{ 'PAC.KEY_WORDS.BUSINESS_AREA' | translate: {Default: "Business Area"} }}
        </h4>
    </header>
    
    <mat-dialog-content class="flex flex-col justify-start items-start">
        <mat-form-field appearance="outline">
            <mat-label>{{ 'PAC.KEY_WORDS.NAME' | translate: {Default: 'Name'} }}</mat-label>
            <input cdkFocusInitial matInput [(ngModel)]="name" />
        </mat-form-field>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <div ngmButtonGroup>
            <button mat-stroked-button mat-dialog-close>
                {{ 'COMPONENTS.COMMON.CANCEL' | translate: {Default: 'Cancel'} }}    
            </button>
            <button mat-raised-button color="accent" cdkFocusInitial [mat-dialog-close]="name">
                {{ 'COMPONENTS.COMMON.APPLY' | translate: {Default: 'Apply'} }}
            </button>
        </div>
    </mat-dialog-actions>    
</ng-template>
