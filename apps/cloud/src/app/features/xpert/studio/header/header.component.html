<div>
  <div class="flex items-center gap-2 h-[18px] text-sm opacity-50">
    @if (unsaved()) {
      <span class="w-2 h-2 rounded-full bg-green-500 shadow-md shadow-green-400"
        [matTooltip]="'PAC.Messages.UnsavedChanges' | translate: {Default: 'Unsaved changes'} ">
      </span>
    }
    @if (draftSavedDate()) {
      <span>{{ 'PAC.Xpert.AutoSave' | translate: {Default: 'Auto save'} }} {{draftSavedDate()}}</span>
    }
    @if (latestPublishDate()) {
      <span class="flex items-center mx-1">Â·</span>{{ 'PAC.Xpert.Published' | translate: {Default: 'Published'} }} {{latestPublishDate()}}
    }
  </div>
</div>

<div class="flex-1"></div>

<div class="flex items-center gap-2">
  <button type="button" class="btn disabled:btn-disabled btn-secondary btn-medium h-8 justify-center"
    [ngmTooltip]="envInDevelopment"
    [hideDelay]="100"
  >
    <svg
      width="16"
      height="16"
      viewBox="0 0 16 16"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      class="w-4 h-4 text-components-button-secondary-text"
    >
      <g id="env">
        <g id="Vector">
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M1.33325 3.33325C1.33325 2.22868 2.22868 1.33325 3.33325 1.33325H12.6666C13.7712 1.33325 14.6666 2.22869 14.6666 3.33325V3.66659C14.6666 4.03478 14.3681 4.33325 13.9999 4.33325C13.6317 4.33325 13.3333 4.03478 13.3333 3.66659V3.33325C13.3333 2.96506 13.0348 2.66659 12.6666 2.66659H3.33325C2.96506 2.66659 2.66659 2.96506 2.66659 3.33325V3.66659C2.66659 4.03478 2.36811 4.33325 1.99992 4.33325C1.63173 4.33325 1.33325 4.03478 1.33325 3.66659V3.33325Z"
            fill="currentColor"
          ></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M14.6666 12.6666C14.6666 13.7712 13.7712 14.6666 12.6666 14.6666L3.33325 14.6666C2.22866 14.6666 1.33325 13.7711 1.33325 12.6666L1.33325 12.3333C1.33325 11.9651 1.63173 11.6666 1.99992 11.6666C2.36811 11.6666 2.66659 11.9651 2.66659 12.3333V12.6666C2.66659 13.0348 2.96505 13.3333 3.33325 13.3333L12.6666 13.3333C13.0348 13.3333 13.3333 13.0348 13.3333 12.6666V12.3333C13.3333 11.9651 13.6317 11.6666 13.9999 11.6666C14.3681 11.6666 14.6666 11.9651 14.6666 12.3333V12.6666Z"
            fill="currentColor"
          ></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M1.33325 5.99992C1.33325 5.63173 1.63173 5.33325 1.99992 5.33325H4.33325C4.70144 5.33325 4.99992 5.63173 4.99992 5.99992C4.99992 6.36811 4.70144 6.66658 4.33325 6.66658H2.66659V7.33325H3.99992C4.36811 7.33325 4.66659 7.63173 4.66659 7.99992C4.66659 8.36811 4.36811 8.66658 3.99992 8.66658H2.66659V9.33325H4.33325C4.70144 9.33325 4.99992 9.63173 4.99992 9.99992C4.99992 10.3681 4.70144 10.6666 4.33325 10.6666H1.99992C1.63173 10.6666 1.33325 10.3681 1.33325 9.99992V5.99992Z"
            fill="currentColor"
          ></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M6.4734 5.36186C6.75457 5.27673 7.05833 5.38568 7.22129 5.63012L8.66659 7.79807V5.99992C8.66659 5.63173 8.96506 5.33325 9.33325 5.33325C9.70144 5.33325 9.99992 5.63173 9.99992 5.99992V9.99992C9.99992 10.2937 9.80761 10.5528 9.52644 10.638C9.24527 10.7231 8.94151 10.6142 8.77855 10.3697L7.33325 8.20177V9.99992C7.33325 10.3681 7.03478 10.6666 6.66659 10.6666C6.2984 10.6666 5.99992 10.3681 5.99992 9.99992V5.99992C5.99992 5.70614 6.19222 5.44699 6.4734 5.36186Z"
            fill="currentColor"
          ></path>
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M11.0768 5.38453C11.4167 5.24292 11.807 5.40364 11.9486 5.74351L12.9999 8.26658L14.0512 5.74351C14.1928 5.40364 14.5831 5.24292 14.923 5.38453C15.2629 5.52614 15.4236 5.91646 15.282 6.25633L13.6153 10.2563C13.5118 10.5048 13.2691 10.6666 12.9999 10.6666C12.7308 10.6666 12.488 10.5048 12.3845 10.2563L10.7179 6.25633C10.5763 5.91646 10.737 5.52614 11.0768 5.38453Z"
            fill="currentColor"
          ></path>
        </g>
      </g>
    </svg>
  </button>
  
  <div class="w-[1px] h-3.5 bg-gray-200"></div>
  
  <div
    class="flex items-center p-0.5 rounded-lg border-[0.5px] shadow-sm bg-components-card-bg"
  >
    <div
      class="flex items-center px-2 py-1 rounded-md text-sm font-medium cursor-pointer
        text-text-tertiary hover:bg-primary-50 hover:text-primary-500"
      [ngClass]="preview() ? 'bg-primary-50 text-primary-500' : ''"
      (click)="togglePreview()"
    >
      <svg
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="currentColor"
        class="mr-1 w-5 h-5"
      >
        <path
          d="M8 18.3915V5.60846L18.2264 12L8 18.3915ZM6 3.80421V20.1957C6 20.9812 6.86395 21.46 7.53 21.0437L20.6432 12.848C21.2699 12.4563 21.2699 11.5436 20.6432 11.152L7.53 2.95621C6.86395 2.53993 6 3.01878 6 3.80421Z"
        ></path>
      </svg>
      {{ 'PAC.Xpert.Preview' | translate: {Default: 'Preview'} }}
    </div>
    <div class="mx-0.5 w-[1px] h-3.5 bg-divider-regular"></div>
    <div class="inline-block">
      <div
        class="group flex items-center justify-center px-2 py-1 rounded-md cursor-pointer
          text-text-tertiary hover:bg-primary-50 hover:text-primary-500"
        [floatUi]="conversations"
        [placement]="eNgxFloatUiPlacements.BOTTOMSTART"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 16 16"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
        >
          <g id="Icon" clip-path="url(#clip0_635_10941)">
            <path
              id="Vector"
              d="M14.6334 8.66683C14.6552 8.44756 14.6663 8.22516 14.6663 8.00016C14.6663 4.31826 11.6816 1.3335 7.99967 1.3335C4.31778 1.3335 1.33301 4.31826 1.33301 8.00016C1.33301 11.6821 4.31778 14.6668 7.99967 14.6668C8.11145 14.6668 8.22258 14.6641 8.33301 14.6586C8.44487 14.6531 8.556 14.6449 8.66634 14.6339M7.99967 4.00016V8.00016L5.42265 9.25534M11.853 9.97346L14.4308 11.9068C14.6238 12.0515 14.7203 12.1239 14.7548 12.2126C14.785 12.2904 14.785 12.3766 14.7548 12.4543C14.7203 12.543 14.6238 12.6154 14.4308 12.7601L11.853 14.6935C11.5784 14.8995 11.441 15.0024 11.3261 15.0001C11.226 14.998 11.1322 14.9511 11.0706 14.8723C10.9997 14.7818 10.9997 14.6101 10.9997 14.2668V10.4001C10.9997 10.0568 10.9997 9.88516 11.0706 9.79463C11.1322 9.71585 11.226 9.66895 11.3261 9.66687C11.441 9.66448 11.5784 9.76747 11.853 9.97346Z"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            ></path>
          </g>
          <defs>
            <clipPath id="clip0_635_10941"><rect width="16" height="16" fill="white"></rect></clipPath>
          </defs>
        </svg>
      </div>
    </div>
    <div class="inline-block" >
      <div class="relative ml-0.5 flex items-center justify-center w-7 h-7 rounded-md">
        <div
          class="group flex items-center justify-center w-full h-full rounded-md cursor-pointer
              text-text-tertiary hover:bg-primary-50 hover:text-primary-500"
          [ngmTooltip]="checklistInDevelopment"
          [hideDelay]="100"
        >
          <svg
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            class="w-5 h-5"
          >
            <path
              d="M8.00008 6V9H5.00008V6H8.00008ZM3.00008 4V11H10.0001V4H3.00008ZM13.0001 4H21.0001V6H13.0001V4ZM13.0001 11H21.0001V13H13.0001V11ZM13.0001 18H21.0001V20H13.0001V18ZM10.7072 16.2071L9.29297 14.7929L6.00008 18.0858L4.20718 16.2929L2.79297 17.7071L6.00008 20.9142L10.7072 16.2071Z"
            ></path>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <button
    type="button"
    class="btn disabled:btn-disabled btn-medium"
    [ngmTooltip]="featuresInDevelopment"
    [hideDelay]="100"
  >
    <svg
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      fill="currentColor"
      class="w-4 h-4 mr-1 inline-block"
    >
      <path
        d="M2.5 7C2.5 9.48528 4.51472 11.5 7 11.5C9.48528 11.5 11.5 9.48528 11.5 7C11.5 4.51472 9.48528 2.5 7 2.5C4.51472 2.5 2.5 4.51472 2.5 7ZM2.5 17C2.5 19.4853 4.51472 21.5 7 21.5C9.48528 21.5 11.5 19.4853 11.5 17C11.5 14.5147 9.48528 12.5 7 12.5C4.51472 12.5 2.5 14.5147 2.5 17ZM12.5 17C12.5 19.4853 14.5147 21.5 17 21.5C19.4853 21.5 21.5 19.4853 21.5 17C21.5 14.5147 19.4853 12.5 17 12.5C14.5147 12.5 12.5 14.5147 12.5 17ZM9.5 7C9.5 8.38071 8.38071 9.5 7 9.5C5.61929 9.5 4.5 8.38071 4.5 7C4.5 5.61929 5.61929 4.5 7 4.5C8.38071 4.5 9.5 5.61929 9.5 7ZM9.5 17C9.5 18.3807 8.38071 19.5 7 19.5C5.61929 19.5 4.5 18.3807 4.5 17C4.5 15.6193 5.61929 14.5 7 14.5C8.38071 14.5 9.5 15.6193 9.5 17ZM19.5 17C19.5 18.3807 18.3807 19.5 17 19.5C15.6193 19.5 14.5 18.3807 14.5 17C14.5 15.6193 15.6193 14.5 17 14.5C18.3807 14.5 19.5 15.6193 19.5 17ZM16 11V8H13V6H16V3H18V6H21V8H18V11H16Z"
      ></path></svg
    >{{ 'PAC.Xpert.Features' | translate: {Default: 'Features'} }}
  </button>

  <button class="no-underline group cursor-pointer relative shadow-2xl rounded-lg px-2 py-1 text-sm font-semibold leading-6 inline-block
    bg-primary-500 shadow-zinc-900 text-white"
    [disabled]="publishing()"
    [cdkMenuTriggerFor]="publishMenu"
  >
    <span>{{ 'PAC.Xpert.Publish' | translate: {Default: 'Publish'} }}</span>
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="inline-block w-4 h-4 ml-0.5">
      <path d="M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"></path>
    </svg>
  </button>

</div>

<ng-template #publishMenu>
  <div class="ngm-cdk-menu w-80" cdkMenu @overlayAnimation1>
    <div class="flex flex-col px-2 pt-2 pb-4 text-gray-500">
      <div class="flex items-center h-6 font-medium uppercase mb-2 text-sm">
        {{ 'PAC.Xpert.LatestPublish' | translate: {Default: 'Latest Publish'} }}
      </div>
      <div cdkMenuItem class="ngm-cdk-menu-item flex justify-between items-center p-2"
        [cdkMenuTriggerFor]="versionMenu"
        [cdkMenuPosition]="[
          {
            originX: 'start',
            originY: 'top',
            overlayX: 'end',
            overlayY: 'top',
            offsetX: -12,
          }
        ]"  
      >
        <div class="flex items-center mt-[3px] mb-[3px] font-medium text-sm">
          @if (version()) {
            {{ 'PAC.KEY_WORDS.Version' | translate: {Default: 'Version'} }}: {{version()}}
            @if (latest()) {
              <div class="ml-1 text-xs inline-flex items-center font-bold leading-sm uppercase px-3 py-1 bg-green-200 text-green-700 rounded-lg">
                {{ 'PAC.Xpert.Latest' | translate: {Default: 'latest'} }}
              </div>
            }
          } @else {
            <span class="text-xs inline-flex items-center font-bold leading-sm uppercase px-3 py-1 bg-orange-200 text-orange-700 rounded-lg">
              {{ 'PAC.Xpert.Draft' | translate: {Default: 'draft'} }}
            </span>
          }
        </div>
        @if (draft()) {
          <button type="button" class="self-center px-2 py-1 rounded-lg border border-token-border-medium text-sm transition duration-200
            text-primary-600 hover:bg-primary-50 active:bg-primary-100" (click)="resume()">
            {{ 'PAC.Xpert.Reset' | translate: {Default: 'Reset'} }}
          </button>
        }
      </div>

      <button class="mt-2 no-underline group cursor-pointer relative shadow-2xl rounded-lg p-2 text-base font-semibold leading-6 inline-block
        bg-primary-500 shadow-zinc-900 text-white
        disabled:bg-primary-100 disabled:shadow-none disabled:cursor-not-allowed"
        [disabled]="publishing() || !draft()"
        (click)="publish()"
      >
        <span>{{ 'PAC.Xpert.ReleaseNewVersion' | translate: {Default: 'Release as new version'} }}</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="inline-block w-4 h-4 ml-0.5">
          <path d="M21.7267 2.95694L16.2734 22.0432C16.1225 22.5716 15.7979 22.5956 15.5563 22.1126L11 13L1.9229 9.36919C1.41322 9.16532 1.41953 8.86022 1.95695 8.68108L21.0432 2.31901C21.5716 2.14285 21.8747 2.43866 21.7267 2.95694ZM19.0353 5.09647L6.81221 9.17085L12.4488 11.4255L15.4895 17.5068L19.0353 5.09647Z"></path>
        </svg>
      </button>
    </div>
  </div>
</ng-template>

<ng-template #versionMenu>
  <div class="ngm-cdk-menu p-2" cdkMenu @overlayAnimation1>
    @for (item of versions(); track item.version) {
      <button class="ngm-cdk-menu-item px-2 py-1" cdkMenuItem
        [matTooltip]=" ('PAC.Xpert.PublishAt' | translate: {Default: 'Publish at'}) + ':' + (item.publishAt | date: 'short') "
        matTooltipPosition="before"
        [matTooltipDisabled]="!item.publishAt"
        (click)="selectVersion(item.id)">
        @if (item.version) {
          v{{item.version}}
        } @else {
          {{ 'PAC.Xpert.Draft' | translate: {Default: 'Draft'} }}
        }
        @if (item.version === version()) {
            <div class="ml-4 text-xs inline-flex items-center px-2 font-bold leading-sm uppercase text-primary-600 rounded-lg">
              current
            </div>
        }
      </button>
    }
  </div>
</ng-template>

<float-ui-content #conversations>
  <div class="ngm-cdk-menu p-2 w-96 max-w-md">
    @for (item of conversations$ | async; track item.id) {
      <button class="ngm-cdk-menu-item px-2 py-1 max-w-full flex flex-col justify-start items-start"
        [title]="item.title"
        (click)="conversations.hide();openConversation(item)">
        <div class="text-start text-sm max-w-full truncate">{{item.title}}</div>
        <div class="text-start text-xs max-w-full text-text-tertiary">{{item.createdAt | date: 'medium'}}</div>
      </button>
    } @empty {
      <div class="w-32 h-8 flex justify-center items-center">
        {{ 'PAC.Xpert.NoChatHistory' | translate: {Default: 'No chat history'} }}
      </div>
    }
  </div>
</float-ui-content>


<ng-template #envInDevelopment>
  <pac-in-development @overlayAnimation1 feature="Enviroments for variable and parameter" class="w-96" />
</ng-template>

<ng-template #checklistInDevelopment >
  <pac-in-development @overlayAnimation1 feature="Checklist" class="w-80" />
</ng-template>

<ng-template #featuresInDevelopment >
  <pac-in-development @overlayAnimation1 feature="Features" class="w-80" />
</ng-template>
